# Agent Development Guide

## Project: {{project_name}}

{{project_about}}

## Workflow: Trunk-Based Development

This project uses **trunk-based development**:

- All work happens on `main` branch (or short-lived feature branches)
- Runr creates verified checkpoints with full test evidence
- Submit verified changes to `main` via: **bundle → dry-run → submit → (git push)**
- **Use wrappers for safety, not manual steps**

**Key principle**: Main is always green. Only verified changes land.

## Verification Requirements

All checkpoints must pass verification before submit:

{{verification_commands}}

## Working with Runr

### Create a verified checkpoint

```bash
runr run --task .runr/tasks/my-task.md --worktree
```

This creates a checkpoint with full verification evidence.

### Submit verified changes to main

**Preferred (uses wrapper for safety):**
```bash
./scripts/dogfood-submit.sh <checkpoint-id> --to main
```

**Manual (escape hatch only):**
```bash
runr submit <checkpoint-id> --to main
```

Both apply the verified checkpoint to `main` (requires clean tree + verification evidence).

### View bundle/evidence

```bash
runr bundle <checkpoint-id> --output /tmp/bundle-<checkpoint-id>.md
```

Shows the complete change bundle with verification results.

## Guidelines for Agents

1. **Read first**: Always read files before modifying
2. **Verify incrementally**: Don't wait until the end to verify
3. **Keep changes focused**: Smaller checkpoints are easier to review and submit
4. **Trust verification**: If verification passes, the change is trustable
5. **Main is always deployable**: Never break main with unverified changes

## When You MUST Dogfood (Objective Triggers)

Use the dogfood wrapper for any change touching:

- `src/commands/*` (any command implementation)
- Git state mutations (submit/resume/checkpoint/doctor)
- `.runr/` layout, config, or schema changes
- Timeline events (any code writing to timeline.jsonl)

**This is how we ship. No exceptions unless you're explicitly doing a spike.**

## Do / Don't

**DO:**
- `./scripts/test-gate-cases.sh` once per week (or before tagging)
- `./scripts/dogfood-submit.sh <run_id> --to main` for every verified run
- Log friction if it costs >2 minutes OR happens twice (see `docs/workflow-v1-hardening-log.md`)

**DON'T:**
- Use `--push` during week 1 dogfooding (Git owns push - Option B locked)
- Ship without hitting the release gate checklist
- Skip the wrapper and run `runr submit` manually (use escape hatch sparingly)

## Project Structure

See the existing codebase for structure. Runr automatically detects verification commands from your project setup.
