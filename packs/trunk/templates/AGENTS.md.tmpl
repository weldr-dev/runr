# Agent Development Guide

## Project: {{project_name}}

{{project_about}}

## Workflow: Trunk-Based Development

This project uses **trunk-based development**:

- All work happens on `main` branch
- Runr creates checkpoints as you work
- **Verification is the gate**: Only verified checkpoints are "publishable"
- `runr submit` in trunk mode is a **verification check + audit event** (not a branch operation)

**Key principle**: Main is always green. Checkpoints are your safety net.

## Verification Requirements

All checkpoints must pass verification before submit:

{{verification_commands}}

## Working with Runr

### Create a verified checkpoint

```bash
runr run --task .runr/tasks/my-task.md --worktree
```

This creates a checkpoint with full verification evidence.

### Mark checkpoint as publishable

In trunk mode, you're already on `main`. Submit verifies you have a clean checkpoint:

```bash
runr submit <checkpoint-id> --to main
```

This verifies:
- Checkpoint exists and is verified
- You're on the correct branch (main)
- Tree is clean

**Note:** In trunk mode, submit is mostly a **no-op audit event**. The real gate is verification.

**What actually matters:** Only push verified checkpoints upstream:
```bash
# After verifying checkpoint is good
git push origin main
```

### View bundle/evidence

```bash
runr bundle <checkpoint-id> --output /tmp/bundle-<checkpoint-id>.md
```

Shows the complete change bundle with verification results.

## Guidelines for Agents

1. **Read first**: Always read files before modifying
2. **Verify incrementally**: Don't wait until the end to verify
3. **Keep changes focused**: Smaller checkpoints are easier to review and submit
4. **Trust verification**: If verification passes, the change is trustable
5. **Main is always deployable**: Never break main with unverified changes

## Integration Safety Rules

**When to use wrapper vs manual:**
- **Wrapper (preferred):** If your project has a submit wrapper script, use it for automated safety checks
- **Manual (escape hatch):** Use `runr submit` directly for quick iterations or when no wrapper exists

**If any invariant breaks during submit:**
- Stop immediately
- Add regression test to prevent recurrence
- Fix the invariant violation before continuing

**Optional friction logging:**
- If something costs >2 minutes or happens twice, consider logging it for team discussion

## Project Structure

See the existing codebase for structure. Runr automatically detects verification commands from your project setup.
